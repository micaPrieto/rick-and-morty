<div class="comments-container">

  <!-- Error State -->
  <div *ngIf="isError" class="alert alert-danger d-flex align-items-center mb-4" role="alert">
    <i class="fas fa-exclamation-triangle me-3"></i>
    <div>{{ isError }}</div>
  </div>

  <!-- Comments List -->
  <div *ngIf="!isError && comments.length > 0; else noComments" class="comments-list">

    <!-- Header de la sección -->
    <div class="comments-header mb-4">
      <h5 class="text-white d-flex align-items-center mb-0">
        <i class="fas fa-comments me-3"></i>
        Comentarios ({{ comments.length }})
      </h5>
      <small class="text-muted">Compartiendo opiniones sobre este episodio</small>
    </div>

    <!-- Cada comentario -->
    <div *ngFor="let comment of comments; trackBy: trackByCommentId"
         class="comment-item mb-4"
         [class.comment-hidden]="comment.state === false">

      <div class="card comment-card border-0 shadow-sm">

        <!-- Header del comentario -->
        <div class="card-header comment-header d-flex justify-content-between align-items-center">
          <div class="d-flex align-items-center">
            <div class="user-avatar me-3">
              <i class="fas fa-user-circle"></i>
            </div>
            <div>
              <h6 class="mb-0 text-white fw-bold">{{ comment.userName }}</h6>
              <small class="text-muted">
                <i class="fas fa-clock me-1"></i>
                {{ comment.creationDate | commentDate }}
              </small>
            </div>
          </div>

          <!-- Estado del comentario (solo si está oculto) -->
          <div *ngIf="comment.state === false" class="comment-badges">
            <span class="badge bg-warning text-dark">
              <i class="fas fa-eye-slash me-1"></i>Oculto
            </span>
          </div>
        </div>

        <!-- Contenido del comentario -->
        <div class="card-body">

          <!-- Modo edición -->
          <div *ngIf="editingCommentId === comment.id; else showContent" class="edit-mode">
            <div class="form-floating mb-3">
              <textarea
                [(ngModel)]="editedContent"
                class="form-control comment-textarea"
                rows="3"
                id="editTextarea"
                placeholder="Editar comentario..."
                style="min-height: 100px; resize: none;"
              ></textarea>
              <label for="editTextarea" class="text-muted">
                <i class="fas fa-edit me-2"></i>Editando comentario...
              </label>
            </div>

            <div class="edit-actions d-flex gap-2">
              <button
                class="btn btn-success btn-sm d-flex align-items-center"
                (click)="saveEdit()"
                [disabled]="!editedContent.trim()"
              >
                <i class="fas fa-save me-2"></i>
                Guardar
              </button>
              <button
                class="btn btn-outline-secondary btn-sm d-flex align-items-center"
                (click)="cancelEdit()"
              >
                <i class="fas fa-times me-2"></i>
                Cancelar
              </button>
            </div>
          </div>

          <!-- Modo visualización -->
          <ng-template #showContent>
            <p class="comment-text mb-3">{{ comment.comment }}</p>

            <!-- Botones de acción -->
            <div class="comment-actions d-flex flex-wrap gap-2">

              <!-- Botón editar (solo si es el autor) -->
              <button
                *ngIf="comment.userId === currentUserId"
                class="btn btn-outline-info btn-sm action-btn"
                (click)="startEdit(comment)"
                title="Editar comentario"
              >
                <i class="fas fa-edit me-1"></i>
                Editar
              </button>

              <!-- Botón eliminar (si es autor o admin) -->
              <button
                *ngIf="canEditOrDelete(comment)"
                class="btn btn-outline-danger btn-sm action-btn"
                (click)="delete(comment.id)"
                title="Eliminar comentario"
              >
                <i class="fas fa-trash me-1"></i>
                Eliminar
              </button>

              <!-- Botón cambiar estado (solo admin) -->
              <button
                *ngIf="isAdmin"
                class="btn btn-outline-warning btn-sm action-btn"
                (click)="toggleCommentState(comment)"
                [title]="comment.state ? 'Ocultar comentario' : 'Mostrar comentario'"
              >
                <i class="fas" [class.fa-eye-slash]="comment.state" [class.fa-eye]="!comment.state" [class.me-1]="true"></i>
                {{ comment.state ? 'Ocultar' : 'Mostrar' }}
              </button>
            </div>
          </ng-template>
        </div>
      </div>
    </div>
  </div>

  <!-- No hay comentarios -->
  <ng-template #noComments>
    <div class="no-comments-state text-center py-5">
      <div class="no-comments-icon mb-3">
        <i class="fas fa-comment-slash"></i>
      </div>
      <h6 class="text-muted mb-2">No hay comentarios todavía</h6>
      <p class="text-muted small">¡Sé el primero en compartir tu opinión sobre este episodio!</p>
    </div>
  </ng-template>
</div>



<!-- <div *ngIf="isError; else showComments">
  <p class="error">{{ isError }}</p>
</div>

<ng-template #showComments>
  <div *ngIf="comments.length > 0; else noComments">
    <div *ngFor="let comment of comments" class="comment">

      <p><strong>{{ comment.userName }}</strong> comentó:</p>


      <div *ngIf="editingCommentId === comment.id; else showText">
        <textarea [(ngModel)]="editedContent" rows="3" class="form-control"></textarea>
        <div class="mt-2">
          <button class="btn btn-success btn-sm me-2" (click)="saveEdit()">Guardar</button>
          <button class="btn btn-secondary btn-sm" (click)="cancelEdit()">Cancelar</button>
        </div>
      </div>


      <ng-template #showText>
        <p>{{ comment.comment }}</p>
        <small>{{ comment.creationDate | commentDate }}</small>


        <span
          *ngIf="comment.state === false"
          class="badge bg-secondary ms-2"
          >Oculto</span
        >


        <button
          *ngIf="comment.userId === currentUserId"
          class="btn btn-outline-primary btn-sm mt-1 me-2"
          (click)="startEdit(comment)"
        >
          Editar
        </button>


        <button
          *ngIf="canEditOrDelete(comment)"
          class="btn btn-outline-danger btn-sm mt-1 me-2"
          (click)="delete(comment.id)"
        >
          Eliminar
        </button>


        <button
          *ngIf="isAdmin"
          class="btn btn-outline-warning btn-sm mt-1"
          (click)="toggleCommentState(comment)"
        >
          {{ comment.state ? 'Ocultar' : 'Mostrar' }}
        </button>
      </ng-template>

      <hr />
    </div>
  </div>
</ng-template>

<ng-template #noComments>
  <p>No hay comentarios todavía.</p>
</ng-template> -->
